<include file="/public/header"  />
<style>
    body{
        background: none;
    }
     #purchase
     {
          width:1200px;
          margin:0 auto;
          /*border: 1px solid #000;*/
         margin-top:15px;
         padding-bottom:60px;
     }
     .clear{
          clear: both;
     }
     .goods
     {
          height:200px;
          width:100%;
          /*background: #e2e2e2;*/
         border: 1px solid gray;
         -webkit-border-radius: 8px;
         -moz-border-radius: 8px;
         border-radius: 8px;
         box-sizing: border-box;
         padding: 2px;
         background: rgb(200,67,101);
     }
     .goods>.left
     {
          float: left;
          width:25%;
          height:100%;
     }
     .goods>.right
     {
          float: left;
          width:75%;
          height:100%;
          
     }

     #total-price
     {
         font-size: 18px;
         color: #000;
     }
     .goods>.left img
     {
          width:100%;
          height:100%;
          float: left;
         -webkit-border-radius: 8px;
         -moz-border-radius: 8px;
         border-radius: 8px;
     }
     .good_attributes
     {
          width:20%;
          height:100%;
          float: left;
     }
     .jieshao
     {
         text-align:center;
          height:50%;
          line-height:100px;
          color: #fff;
         font-size:18px;
     }
    .goods_name,.goods_guige,.goods_shj,.goods_count
    {
        font-size:18px;
        text-align: center;
        color: #000;
        line-height:28px;
    }
     .goods_name{
         font-size:18px;
     }
     .goods_count
     {
         height:30px;
         line-height:30px;
     }
     .goods_shj
     {
         color: #000;
     }
     .user_profile
     {
         margin-top:15px;
         color:#000;
         border-top:1px solid #000;
         font-size:24px;
     }
     .user_profile h2
     {
         font-size: 24px;
         height:50px;
         margin:15px 0;
         line-height:50px;
         text-align: center;
     }
    #address
    {
        width:87%;
        height:50px;
        font-size:18px;
        float: left;
        text-indent:10px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        border-top-right-radius: 8px;
        border-bottom-right-radius: 8px;
        outline: none;

    }
    .phone{
        height:50px;
        line-height:50px;
        margin-top:25px;


    }
    .for-phone,.choose-add,.for-pay
    {
        float: left;
        width:13%;
        font-size:18px;
        height: 50px;
        line-height: 50px;
        background: #eee;
        color: #555;
        border-top-left-radius: 8px;
        border-bottom-left-radius: 8px;
        border: 1px solid #ccc;
        box-sizing: border-box;

    }
    #phone,#txt-bz
    {
        width:87%;
        height:50px;
        font-size:18px;
        float: left;
        font-weight:700;
        text-indent:10px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        border-top-right-radius: 8px;
        border-bottom-right-radius: 8px;
        outline: none;

    }
    .star
    {
        color: red!important;
        font-size: 24px;
    }
    .text-center
    {
        text-align: center!important;
    }

    .pay-way
    {
        height:50px;
        line-height:50px;
        margin-top:25px;
        font-size:16px;
    }
    input[name=pay-way],input[name=send-way]
    {
        height:15px;
        width:15px;
        margin-left:15px;
    }
    .btn{
        height:50px;
        line-height:50px;
        margin-top:25px;
    }
    .total
    {
        float:right;
        font-size:20px;
    }
    .ok-btn
    {
        float: right;
        background: #50ffaf;
        color: #fff;
        font-size:18px;
        padding:10px 35px;
        cursor:pointer;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;

    }
    .reduce,.add-count
    {
        height:30px;
        width:30px;
        display: inline-block;
        background: gray;
        cursor: pointer;
        -webkit-user-select: none;
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
        background: #ff5814;
        font-size: 16px;
        color: #fff;
    }
    .count
    {
        width:30px;
        height: 30px;
        line-height:30px;
        background: #fff;
        font-size:16px;
        display: inline-block;
        -webkit-user-select: none;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        border-radius: 50%;
        background: #ff5a4d;
        color: #fff;
    }
    .checkbox-div
    {
        float: left;
        font-size: 16px;
        position: relative;
    }
</style>
<!--main-->
     <div id="purchase">
         <!--商品详情-->
         <div class="goods">
              <div class="left">
                   <img src="{$data.img_url}" alt="">
              </div>
               <div class="right">
                    <div class="good_attributes">
                         <p class="jieshao">
                              商品名称
                         </p>
                         <p class="goods_name">
                             {$data.name}
                         </p>
                    </div>
                   <div class="good_attributes">
                       <p class="jieshao">
                           商品规格
                       </p>
                       <p class="goods_guige">
                           {$data.guige}
                       </p>
                   </div>
                   <div class="good_attributes">
                       <p class="jieshao">
                           商品价格
                       </p>
                       <p class="goods_shj">
                           {$data.shj}￥
                       </p>
                   </div>

                   <div class="good_attributes">
                       <p class="jieshao">
                           购买数量
                       </p>
                       <p class="goods_count">
                           <span class="reduce" onclick="reduce()">-</span> <span class="count">1</span> <span class="add-count" onclick="addCount()">+</span>
                       </p>
                   </div>



                   <div class="good_attributes">
                       <p class="jieshao">
                           商品总价
                       </p>
                       <p class="goods_shj">
                           <span  id="total-price">{$data.shj}</span>￥
                       </p>
                   </div>
                    <div class="clear"></div>
               </div>

              <div class="clear"></div>
         </div>


         <!--用户信息-->
         <div class="user_profile">
             <h2>填写收货信息</h2>
             <div class="add">
                 <label for="address" class="choose-add text-center"><span class="star">*</span>选择收货地址</label>

                     <if condition="!empty($addlist)" >
                        <select name="address" id="address">
                         <volist name="$addlist" id="vo">
                             <option value="{$vo.id}">
                                 {$vo.address}
                             </option>
                         </volist>
                        </select>
                     <else />
                         <input type="text" name="address" id="address" value="" style="border: 1px solid #000;box-sizing: border-box;" placeholder="请输入您的收货地址..">
                     </if>



             </div>
                <div class="clear"></div>

             <div class="phone">
                 <label for="phone" class="for-phone text-center"><span class="star">*</span>收货手机号码</label>
                 <input type="text" id="phone"  name="phone" value="{$cur_user.mobile}" placeholder="请输入您的收货号码..">
             </div>

                <div class="clear"></div>
             <div class="pay-way">
                 <label  class="for-pay text-center"><span class="star">*</span>支付方式</label>
                 <div class="checkbox-div">
                     <input type="radio" name="pay-way" value="1" checked>支付宝
                 </div>
                 <div class="checkbox-div">
                     <input type="radio" name="pay-way" value="2">微信
                  </div>
                 <div class="checkbox-div">
                     <input type="radio" name="pay-way" value="3">货到付款
                 </div>


             </div>


               <div class="clear"></div>
             <div class="pay-way">
                 <label  class="for-pay text-center">配送方式</label>
                 <input type="radio" name="send-way" value="1" checked>顺丰
                 <input type="radio" name="send-way" value="2">中通
                 <input type="radio" name="send-way" value="3">韵达
             </div>


             <div class="clear"></div>

             <div class="pay-way">
                 <label  class="for-pay text-center">备注</label>
                 <input name="bz" placeholder="请输入您的备注....." id="txt-bz" />
             </div>
             <div class="clear"></div>
             <div class="btn">
                <div class="total">
                    总价: <span class="star"  id="last-total">{$data.shj}</span> <span class="star">￥</span>
                </div>
             </div>

                <div class="clear"></div>
             <button class="ok-btn" onclick="xiaDan()">支付并购买</button>
             <div class="clear"></div>
         </div>
         <div class="clear"></div>
     </div>

<!--/main-->

<include file="public/footer" />
<script>
    //支付并购买
    function xiaDan()
    {
        console.log("{$data.id}");
       // return;
        $.ajax
        ({
            url:"{:url('shop/index/purchase')}",
            type:"POST",
            data:
            {
                "address":$('#address').val(),
                "goods_id":"{$data.id}",
                "user_id":"{$cur_user.id}",
                "goods_count":parseInt($(".count").html()),
                "phone":$("#phone").val(),
                "pay_way":$("input[name=pay-way]").val(),
                "send_way":$("input[name=send-way]").val(),
                "bz":$('#txt-bz').val(),
            },
            dataType:"json",
            success:function(data)
            {
                console.log(data);
                $("#task").show();
                $("#tips .tips-body").html(data.msg);
            },
            error:function(msg)
            {
                console.log(msg);
            }
        });
    }



    function reduce()
    {
        var count = parseInt($(".count").html());
        if(count == 1)
        {
            return false;
        }
        count--;
        $(".count").html(count);

        $('#total-price,#last-total').html(count*parseInt("{$data.shj}"));
    }

    function addCount()
    {
        var count = parseInt($(".count").html());
        count++;
        $(".count").html(count);
        $('#total-price,#last-total').html(count*parseInt("{$data.shj}"));
    }


</script>